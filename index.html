<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Camry Cart</title>
<style>
  body { font-family: "Roboto", Arial, sans-serif; background: #f1f3f4; max-width: 420px; margin: auto; padding: 10px; text-align: center; }
  h1 { font-size: 18px; color: #333; margin-bottom: 8px; }
  #totalQty, #totalCost { font-size: 14px; margin-bottom: 8px; color: #555; }
  #cartList { list-style: none; padding: 0; margin: 0 auto 15px auto; max-width: 100%; text-align: left; }
  #cartList li { background: #fff; border-radius: 8px; margin: 6px 0; padding: 8px 12px; font-size: 13px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
  .item-controls button { margin: 0 3px; border: none; border-radius: 8px; padding: 3px 6px; font-weight: bold; cursor: pointer; font-size: 12px; }
  .plus { background-color: #1a73e8; color: #fff; }
  .minus { background-color: #666; color: #fff; }
  .remove { background-color: #e53935; color: #fff; }
  .cart-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; margin-bottom: 15px; }
  .gs-button { font-family: "Roboto", Arial, sans-serif; font-size: 13px; font-weight: 500; color: #fff; background-color: #1a73e8; border: none; border-radius: 18px; padding: 6px 14px; cursor: pointer; box-shadow: 0 1px 1px rgba(0,0,0,0.2); transition: 0.2s; }
  .gs-button:hover { background-color: #1669c1; }
  .gs-button:active { background-color: #145ab8; transform: scale(0.98); }
  .toast { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); background: #1a73e8; color: #fff; padding: 6px 10px; border-radius: 15px; font-size: 12px; z-index: 9999; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
</style>
</head>
<body>

<h1>Camry Cart</h1>
<div id="totalQty">Total Items: 0</div>
<div id="totalCost">Total Cost: QAR 0</div>
<ul id="cartList"></ul>

<div class="cart-buttons">
  <button class="gs-button" onclick="clearCart()">Clear Cart</button>
</div>

<script>
let cart = JSON.parse(localStorage.getItem('cart')) || {};
let products = [];

// Load JSON
fetch('car_parts.json')
  .then(res => res.json())
  .then(data => {
    products = data;
    handleURLItem(); // add item from URL param
    renderCart();
  })
  .catch(err => console.error(err));

function getProduct(name) {
  return products.find(p => p.Item.toLowerCase() === name.toLowerCase());
}

// Get URL param ?item=
function handleURLItem() {
  const params = new URLSearchParams(window.location.search);
  const newItem = params.get('item');
  if(newItem) {
    const itemName = decodeURIComponent(newItem);
    if(cart[itemName]) cart[itemName] += 1;
    else cart[itemName] = 1;
    localStorage.setItem('cart', JSON.stringify(cart));
    showToast(itemName + " added to cart");
  }
}

const cartList = document.getElementById('cartList');
const totalQtyDiv = document.getElementById('totalQty');
const totalCostDiv = document.getElementById('totalCost');

function renderCart() {
  const keys = Object.keys(cart);
  if(keys.length === 0){
    cartList.innerHTML = "<li>Cart is empty</li>";
    totalQtyDiv.textContent = "Total Items: 0";
    totalCostDiv.textContent = "Total Cost: QAR 0";
    return;
  }

  let totalQty = 0;
  let totalCost = 0;

  cartList.innerHTML = keys.map(item => {
    const product = getProduct(item);
    let details = "";
    if(product) {
      const itemCost = product["Selling Cost (QAR)"] * cart[item];
      totalCost += itemCost;
      details = `<br><small>QAR ${product["Selling Cost (QAR)"]} | Shipping: ${product["Shipping Period"]}</small>`;
    }
    totalQty += cart[item];
    return `<li>
      <span>${item} x ${cart[item]} ${details}</span>
      <span class="item-controls">
        <button class="minus" onclick="decrease('${item}')">âˆ’</button>
        <button class="plus" onclick="increase('${item}')">+</button>
        <button class="remove" onclick="removeItem('${item}')">X</button>
      </span>
    </li>`;
  }).join('');

  totalQtyDiv.textContent = "Total Items: " + totalQty;
  totalCostDiv.textContent = "Total Cost: QAR " + totalCost.toFixed(2);
}

function increase(item){ cart[item] += 1; updateCart(); }
function decrease(item){ if(cart[item]>1) cart[item]-=1; else delete cart[item]; updateCart(); }
function removeItem(item){ delete cart[item]; updateCart(); }
function updateCart(){ localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); }
function clearCart(){ cart = {}; updateCart(); }

function showToast(msg){
  const t = document.createElement('div');
  t.className='toast';
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2000);
}

renderCart();
</script>

</body>
</html>
