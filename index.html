<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  text-align: center;
}
button {
  padding: 8px 12px;
  margin: 4px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}
#cart {
  border-top: 2px solid #ccc;
  padding: 10px;
}
.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 8px 0;
  padding: 8px;
  border: 1px solid #ddd;
}
.qty-btn {
  padding: 4px 8px;
  background: #007bff;
  color: white;
  border-radius: 4px;
}
.remove-btn {
  padding: 4px 8px;
  background: red;
  color: white;
  border-radius: 4px;
}
#total {
  font-weight: bold;
  margin-top: 10px;
}
#checkoutForm {
  display: none;
  margin-top: 15px;
}
input {
  padding: 6px;
  width: 80%;
  margin-top: 10px;
}
</style>
</head>
<body>

<h2>Car Parts Store</h2>

<!-- Example items -->
<div>
  <button onclick="addToCart('Car Door')">Add Car Door</button>
  <button onclick="addToCart('AC Vent')">Add AC Vent</button>
</div>

<div id="cart">
  <h3>Cart</h3>
  <div id="cartItems"></div>
  <div id="total">Total Quantity: 0</div>
  <button onclick="showCheckoutForm()" style="background:green;color:white;">Checkout</button>

  <!-- Checkout form -->
  <div id="checkoutForm">
    <h4>Enter Phone Number</h4>
    <input type="text" id="phoneNumber" placeholder="Phone Number"><br>
    <button style="background:blue;color:white;" onclick="sendEmail()">Confirm Order</button>
  </div>
</div>

<script>
emailjs.init("KL9tzTpfIKMZOOfGi");

let cart = {};

function addToCart(item) {
  if (cart[item]) {
    cart[item]++;
  } else {
    cart[item] = 1;
  }
  renderCart();
}

function changeQty(item, amount) {
  cart[item] += amount;
  if (cart[item] <= 0) {
    delete cart[item];
  }
  renderCart();
}

function removeItem(item) {
  delete cart[item];
  renderCart();
}

function renderCart() {
  const cartItemsDiv = document.getElementById('cartItems');
  cartItemsDiv.innerHTML = '';
  let totalQty = 0;

  for (let item in cart) {
    totalQty += cart[item];
    cartItemsDiv.innerHTML += `
      <div class="cart-item">
        <span>${item} (x${cart[item]})</span>
        <div>
          <button class="qty-btn" onclick="changeQty('${item}', 1)">+</button>
          <button class="qty-btn" onclick="changeQty('${item}', -1)">-</button>
          <button class="remove-btn" onclick="removeItem('${item}')">Remove</button>
        </div>
      </div>
    `;
  }
  document.getElementById('total').innerText = "Total Quantity: " + totalQty;
}

function showCheckoutForm() {
  document.getElementById('checkoutForm').style.display = 'block';
}

function sendEmail() {
  const phone = document.getElementById('phoneNumber').value;
  if (!phone) {
    alert("Please enter your phone number.");
    return;
  }

  let itemsList = Object.keys(cart).map(item => `${item} (x${cart[item]})`).join(", ");
  let qtyList = Object.values(cart).join(", ");

  emailjs.send("service_ezl7f8j", "template_9mrozeg", {
    items: itemsList,
    quantity: qtyList,
  }).then(() => {
    alert("Order sent successfully!");
    cart = {};
    renderCart();
    document.getElementById('checkoutForm').style.display = 'none';
  }).catch(err => {
    alert("Error sending order: " + JSON.stringify(err));
  });
}
</script>
</body>
</html>
