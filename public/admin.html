<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Admin - Manage Car Parts</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: auto; }
  .part { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
  img { max-width: 100px; height: auto; }
</style>
</head>
<body>

<h1>Admin - Manage Car Parts</h1>

<h2>Existing Parts</h2>
<div id="parts"></div>

<h2>Add New Part</h2>
<form id="addPartForm">
  <label>
    Part Name: <br/>
    <input type="text" name="partName" required />
  </label><br/><br/>
  
  <label>
    Image File: <br/>
    <input type="file" name="image" accept="image/*" required />
  </label><br/><br/>
  
  <label>
    Details File (.txt): <br/>
    <input type="file" name="details" accept=".txt" required />
  </label><br/><br/>
  
  <button type="submit">Add Part</button>
</form>

<script>
async function loadParts() {
  const res = await fetch('/api/parts');
  const parts = await res.json();
  const partsDiv = document.getElementById('parts');
  partsDiv.innerHTML = '';
  
  parts.forEach(part => {
    const div = document.createElement('div');
    div.className = 'part';
    div.innerHTML = `
      <h3>${part.name}</h3>
      ${part.imageUrl ? `<img src="${part.imageUrl}" alt="${part.name}"/>` : ''}
      <pre>${part.details}</pre>
    `;
    partsDiv.appendChild(div);
  });
}

document.getElementById('addPartForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const form = e.target;
  const formData = new FormData(form);

  try {
    const res = await fetch('/api/admin/add-part', {
      method: 'POST',
      body: formData
    });
    if (!res.ok) throw new Error(await res.text());
    
    alert('Part added successfully!');
    form.reset();
    loadParts();
  } catch (error) {
    alert('Error: ' + error.message);
  }
});

loadParts();
</script>

</body>
</html>
